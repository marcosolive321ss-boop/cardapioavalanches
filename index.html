<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>Avalanches ‚Äî Card√°pio Digital</title>
  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>

  <style>
    /* --- CONFIGURA√á√ïES GERAIS E TEMA --- */
    :root {
      --bg: #141416;         
      --card: #232326;       
      --input-bg: #2c2c2e;
      --muted: #9ca3af;
      --text: #ffffff;
      --accent: #ff9f0a;     /* Laranja vibrante */
      --accent-glow: rgba(255, 159, 10, 0.2);
      --success: #34c759;    
      --danger: #ff453a;
      --radius: 18px;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body { height: 100%; }

    body {
      margin: 0;
      background-color: var(--bg);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      color: var(--text);
      overflow-x: hidden;
      transition: all 0.3s ease; /* Transi√ß√£o suave para o modo fechado */
    }

    .app { max-width: 500px; margin: 0 auto; padding: 16px; padding-bottom: 100px; min-height: 100vh; }

    /* --- ESTILO DE LOJA FECHADA (NOVO) --- */
    /* Quando o body tiver a classe .closed, aplica isso nos elementos abaixo */
    body.closed .sticky-controls,
    body.closed .menu-list,
    body.closed .cartbar,
    body.closed #cartPage,
    body.closed #modal {
      opacity: 0.5;               /* Deixa meio apagado */
      filter: grayscale(100%);    /* Tira a cor (preto e branco) */
      pointer-events: none;       /* BLOQUEIA TODOS OS CLIQUES */
      user-select: none;
    }
    
    /* Garante que o cabe√ßalho fique normal */
    body.closed .topbar {
      filter: none;
      opacity: 1;
      pointer-events: auto;
    }

    /* --- NOTIFICA√á√ïES (TOAST) --- */
    #toast-container {
      position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
      z-index: 9999; display: flex; flex-direction: column; gap: 10px;
      width: 90%; max-width: 400px; pointer-events: none;
    }
    .toast {
      background: rgba(40, 40, 43, 0.95);
      color: #fff;
      padding: 14px 20px;
      border-radius: 50px;
      font-size: 14px; font-weight: 600;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
      display: flex; align-items: center; gap: 10px;
      animation: slideDown 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.1);
    }
    .toast.error { border-color: var(--danger); color: var(--danger); background: rgba(255, 69, 58, 0.15); }
    .toast.success { border-color: var(--success); color: var(--success); background: rgba(52, 199, 89, 0.15); }
    
    @keyframes slideDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    @keyframes fadeOut { to { opacity: 0; transform: translateY(-20px); } }

    /* --- ANIMA√á√ïES --- */
    @keyframes fadeInUp { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }
    .scale-in { animation: popIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
    @keyframes popIn { from { opacity:0; transform:scale(0.9); } to { opacity:1; transform:scale(1); } }
    @keyframes pulse-green { 0% { box-shadow: 0 0 0 0 rgba(52, 199, 89, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(52, 199, 89, 0); } 100% { box-shadow: 0 0 0 0 rgba(52, 199, 89, 0); } }
    @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(255, 69, 58, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(255, 69, 58, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 69, 58, 0); } }

    /* --- TOPBAR --- */
    .topbar { 
      display: flex; flex-direction: column; 
      align-items: center; margin-bottom: 20px; padding: 20px; 
      background: var(--card); border-radius: 24px; text-align: center;
      border: 1px solid rgba(255,255,255,0.05);
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    .topbar-header { display: flex; align-items: center; gap: 15px; width: 100%; justify-content: center; margin-bottom: 20px; }
    .logo { width: 64px; height: 64px; object-fit: cover; border-radius: 50%; border: 2px solid var(--accent); box-shadow: 0 0 15px var(--accent-glow); }
    .brand h1 { margin: 0; font-size: 26px; font-weight: 800; letter-spacing: -0.5px; }
    .tag { margin: 2px 0 0; color: var(--muted); font-size: 14px; font-weight: 500; }

    /* --- HOR√ÅRIO --- */
    .hours-card { width: 100%; background: rgba(0,0,0,0.2); border-radius: 16px; padding: 15px; border: 1px solid rgba(255,255,255,0.08); position: relative; overflow: hidden; }
    .status-badge { display: inline-flex; align-items: center; gap: 6px; background: rgba(52, 199, 89, 0.15); color: var(--success); padding: 6px 12px; border-radius: 100px; font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px; border: 1px solid rgba(52, 199, 89, 0.3); transition: all 0.3s; }
    .status-dot { width: 8px; height: 8px; background: var(--success); border-radius: 50%; animation: pulse-green 2s infinite; }
    .status-badge.closed { background: rgba(255, 69, 58, 0.15); color: var(--danger); border-color: rgba(255, 69, 58, 0.3); }
    .status-dot.red { background: var(--danger); animation: pulse-red 2s infinite; }
    .hours-grid { display: grid; gap: 8px; }
    .hours-row { display: flex; justify-content: space-between; align-items: center; font-size: 13px; color: #ccc; padding-bottom: 6px; border-bottom: 1px dashed rgba(255,255,255,0.1); }
    .hours-row:last-child { border-bottom: none; padding-bottom: 0; }
    .day-name { font-weight: 600; display: flex; align-items: center; gap: 6px; }
    .day-time { font-family: monospace; font-weight: 700; color: #fff; }
    .small-tag { font-size: 9px; background: #333; padding: 2px 4px; border-radius: 4px; color: #999; margin-left: 4px; }

    /* --- CONTROLES --- */
    .sticky-controls {
      position: sticky; top: 0; z-index: 10;
      background: rgba(20, 20, 22, 0.85);
      backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
      padding: 10px 16px; margin: 0 -16px 15px -16px; 
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .search {
      width: 100%; padding: 12px; border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.08); background: var(--input-bg); color: var(--text);
      font-size: 15px; outline: none; transition: 0.3s;
    }
    .search:focus { border-color: var(--accent); background: #333; }

    .tabs { display: flex; gap: 8px; margin-top: 10px; overflow-x: auto; padding-bottom: 5px; }
    .tabs::-webkit-scrollbar { display: none; }
    .tab {
      padding: 8px 18px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1);
      background: rgba(255,255,255,0.05); color: var(--muted); font-weight: 600;
      white-space: nowrap; font-size: 13px; transition: 0.2s; cursor: pointer;
    }
    .tab.active { background: var(--accent); color: #000; border-color: var(--accent); transform: scale(1.02); }

    /* --- LISTA --- */
    .menu-list { display: flex; flex-direction: column; gap: 12px; }
    .card {
      display: flex; gap: 12px; background: var(--card);
      padding: 10px; border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.03);
      animation: fadeInUp 0.4s ease forwards;
    }
    .thumb { width: 80px; height: 80px; border-radius: 12px; overflow: hidden; background: #000; flex-shrink: 0; }
    .thumb img { width: 100%; height: 100%; object-fit: cover; }
    .info { flex: 1; display: flex; flex-direction: column; justify-content: space-between; padding: 2px 0; }
    .info .title { font-weight: 700; font-size: 16px; margin: 0; color: #fff; line-height: 1.2; }
    .info .desc { color: var(--muted); font-size: 12px; margin-top: 4px; line-height: 1.3; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .row { display: flex; align-items: center; justify-content: space-between; margin-top: 6px; }
    .price { font-weight: 700; color: var(--accent); font-size: 15px; }

    /* --- BARRA --- */
    .cartbar {
      position: fixed; left: 50%; transform: translateX(-50%); bottom: 20px;
      width: calc(100% - 24px); max-width: 450px; height: 64px; 
      background: rgba(30, 30, 33, 0.85); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      border-radius: 100px; padding: 0 8px 0 20px;
      display: flex; justify-content: space-between; align-items: center;
      box-shadow: 0 10px 40px rgba(0,0,0,0.6); z-index: 90;
      border: 1px solid rgba(255,255,255,0.1); transition: transform 0.3s;
    }
    .cartbar.hidden { transform: translate(-50%, 150%); }
    .cart-info { display: flex; flex-direction: column; justify-content: center; }
    .cart-total-label { font-size: 10px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px; }
    #cartSubtotal { font-weight: 800; font-size: 18px; color: var(--text); }
    .btn-view-cart {
      background: var(--accent); color: #000; border: none; padding: 0 24px; height: 48px;
      border-radius: 100px; font-weight: 700; font-size: 14px; cursor: pointer; box-shadow: 0 4px 15px var(--accent-glow);
    }

    /* --- P√ÅGINA SLIDE --- */
    .page-slide {
      position: fixed; inset: 0; background: var(--bg); z-index: 200;
      transform: translateX(100%); transition: transform 0.35s cubic-bezier(0.2, 0.8, 0.2, 1);
      display: flex; flex-direction: column;
    }
    .page-slide.active { transform: translateX(0); }
    .page-header {
      padding: 15px 20px; display: flex; align-items: center; gap: 15px;
      background: rgba(20,20,22,0.95); border-bottom: 1px solid rgba(255,255,255,0.05);
      position: sticky; top: 0; z-index: 10;
    }
    .btn-back-icon {
      background: rgba(255,255,255,0.1); border: none; color: #fff; width: 36px; height: 36px; 
      border-radius: 50%; font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center;
    }
    .page-title { font-size: 18px; font-weight: 700; }
    .page-content { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; }

    /* --- ITEM CARRINHO --- */
    .cart-item { display: flex; align-items: flex-start; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
    .cart-thumb-small { width: 48px; height: 48px; border-radius: 10px; object-fit: cover; margin-right: 12px; background: #000; }
    .cart-item-details { flex: 1; }
    .cart-item-name { font-weight: 600; font-size: 14px; color: #fff; }
    .cart-addons { font-size: 11px; color: var(--accent); margin-top: 2px; }
    .cart-obs { font-size: 11px; color: var(--muted); font-style: italic; }
    .cart-actions-row { display: flex; justify-content: space-between; align-items: center; margin-top: 6px; }
    .remove-link { font-size: 11px; color: #ff453a; font-weight: 600; text-decoration: underline; cursor: pointer;}
    .cart-price-right { text-align: right; }
    .cart-qty-price { font-size: 11px; color: var(--muted); }
    .cart-total-price { font-weight: 700; font-size: 14px; }

    /* --- MAPA E INPUTS --- */
    .map-container {
      width: 100%; height: 200px; 
      border-radius: 16px; margin-bottom: 15px; 
      overflow: hidden; border: 1px solid rgba(255,255,255,0.1);
      position: relative; z-index: 1;
    }
    #map { width: 100%; height: 100%; }
    
    .btn-locate {
      margin-bottom: 15px; background: rgba(255,255,255,0.1); color: var(--accent);
      border: 1px dashed var(--accent); font-size: 13px;
    }

    .section-title { font-size: 14px; font-weight: 700; color: var(--accent); margin: 25px 0 10px 0; text-transform: uppercase; letter-spacing: 0.5px; }
    
    /* REMOVIDO: .addr-row, .addr-grow, .addr-fixed pois causavam o erro visual */

    /* INPUTS COM VALIDA√á√ÉO VISUAL */
    .clean-input { 
      width: 100%; padding: 14px; border-radius: 12px; background: var(--input-bg); 
      border: 1px solid rgba(255,255,255,0.08); color: #fff; margin-bottom: 10px; outline: none; font-size: 15px;
      -webkit-appearance: none; appearance: none;
      transition: all 0.2s;
    }
    .clean-input:focus { border-color: var(--accent); background: #333; }
    .input-error { border-color: #ff453a !important; background: rgba(255, 69, 58, 0.1) !important; animation: shake 0.4s; }
    .input-valid { border-color: #34c759 !important; background: rgba(52, 199, 89, 0.1) !important; }
    
    @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

    textarea.clean-input, textarea#note { resize: none; height: 100px; font-family: inherit; }

    /* --- PAGAMENTO COMPACTO --- */
    .pay-list { display: grid; grid-template-columns: 1fr; gap: 8px; }
    .pay-option {
      display: flex; align-items: center; padding: 12px;
      background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 14px; cursor: pointer; transition: all 0.2s;
    }
    .pay-icon-box {
      width: 36px; height: 36px; min-width: 36px; border-radius: 50%;
      background: rgba(255, 255, 255, 0.05); display: flex; align-items: center; justify-content: center;
      font-size: 16px; margin-right: 12px; 
    }
    .pay-info { flex: 1; display: flex; flex-direction: column; }
    .pay-title { font-weight: 600; font-size: 14px; color: #fff; }
    .pay-desc { font-size: 11px; color: var(--muted); margin-top: 2px; }
    .pay-check { width: 18px; height: 18px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.15); position: relative; }
    .pay-option.selected { background: rgba(255, 149, 0, 0.1); border-color: var(--accent); }
    .pay-option.selected .pay-icon-box { background: var(--accent); color: #000; }
    .pay-option.selected .pay-check { background: var(--accent); border-color: var(--accent); }
    .pay-option.selected .pay-check::after { content: ''; position:absolute; width: 6px; height: 3px; border: 2px solid #000; border-top: 0; border-right: 0; top: 4px; left: 3px; transform: rotate(-45deg); }

    /* --- BOT√ïES --- */
    .btn { padding: 14px; border-radius: 12px; border: 0; cursor: pointer; font-weight: 700; font-size: 15px; width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px; }
    .btn.primary { background: var(--accent); color: #000; }
    .btn.whatsapp { background: #25D366; color: #fff; }
    .btn.ghost { background: transparent; color: var(--muted); border: 1px solid rgba(255,255,255,0.1); }
    
    /* MODAIS */
    .modal-back {
      position: fixed; inset: 0; background: rgba(0,0,0,0.85);
      display: none; align-items: flex-end; justify-content: center; z-index: 300; backdrop-filter: blur(5px);
    }
    .modal-card {
      background: #1c1c1e; width: 100%; max-width: 500px;
      border-radius: 24px 24px 0 0; padding: 24px;
      max-height: 90vh; overflow-y: auto; 
    }
    .modal-hero-img {
      width: 100%; height: 200px; object-fit: cover; border-radius: 16px; 
      margin-bottom: 16px; border: 1px solid rgba(255,255,255,0.1);
    }

    .addon-label { display: flex; justify-content: space-between; padding: 12px; border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; margin-bottom: 8px; align-items: center; }
    .addon-label.active { border-color: var(--accent); background: rgba(255,159,10,0.1); }
    .qty-row { display: flex; align-items: center; gap: 10px; background: rgba(255,255,255,0.05); padding: 5px; border-radius: 10px; width: fit-content; margin: 15px 0;}
    .qty-btn { width: 32px; height: 32px; background: rgba(255,255,255,0.1); border: none; color: #fff; border-radius: 8px; font-size: 18px; cursor: pointer;}
    .qty-input { width: 40px; background: transparent; border: none; color: #fff; text-align: center; font-weight: bold; font-size: 16px; }

  </style>
  
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
</head>
<body>

  <div id="toast-container"></div>

  <main class="app">
    <header class="topbar">
      <div class="topbar-header">
        <img src="logo.jpeg" alt="Avalanches" class="logo">
        <div class="brand">
          <h1>Avalanches</h1>
          <p class="tag">Card√°pio Digital</p>
        </div>
      </div>

      <div class="hours-card">
        <div class="status-badge" id="storeStatus"><span class="status-dot"></span> Carregando...</div>
        <div class="hours-grid">
          <div class="hours-row">
            <span class="day-name">üóì Dom, Seg, Ter, Qua, Qui</span>
            <span class="day-time">19:00 ‚Äî 23:59</span>
          </div>
          <div class="hours-row">
            <span class="day-name">üóì Sexta</span>
            <span class="day-time">19:00 ‚Äî 02:30 <span class="small-tag">S√°b</span></span>
          </div>
          <div class="hours-row">
            <span class="day-name">üóì S√°bado</span>
            <span class="day-time">19:00 ‚Äî 02:30 <span class="small-tag">Dom</span></span>
          </div>
        </div>
      </div>

    </header>

    <div class="sticky-controls">
      <input id="search" class="search" placeholder="O que deseja hoje?" aria-label="buscar">
      <div class="tabs">
        <button class="tab active" data-cat="all">Tudo</button>
        <button class="tab" data-cat="hamburgueres">Burguers</button>
        <button class="tab" data-cat="bebidas">Bebidas</button>
      </div>
    </div>

    <section id="menuList" class="menu-list"></section>
  </main>

  <nav class="cartbar" id="cartbar" style="display:none;">
    <div class="cart-info">
      <div class="cart-total-label">Total estimado</div>
      <div id="cartSubtotal">R$0,00</div>
    </div>
    <button id="openCartBtn" class="btn-view-cart">Ver Sacola</button>
  </nav>

  <div id="cartPage" class="page-slide">
    <div class="page-header">
      <button id="closeCartBtn" class="btn-back-icon">‚Üê</button>
      <div class="page-title">Finalizar Pedido</div>
    </div>
    
    <div class="page-content">
      <div id="cartItems"></div>

      <div class="section-title">üìç Entrega</div>
      
      <div class="map-container">
        <div id="map"></div>
      </div>
      <button id="btnLocate" class="btn btn-locate">üìç Usar minha localiza√ß√£o atual</button>

      <input id="clientName" class="clean-input" placeholder="Seu Nome *">
      
      <input id="clientAddress" class="clean-input" placeholder="Rua e Bairro (pelo Mapa) *">
      <input id="houseNumber" class="clean-input" placeholder="N√∫mero da Casa *" type="tel" inputmode="numeric">
      
      <div class="section-title">üí≥ Pagamento</div>
      <div class="pay-list">
        <div class="pay-option" onclick="selectPay(this, 'dinheiro')">
          <div class="pay-icon-box">üíµ</div>
          <div class="pay-info"><span class="pay-title">Dinheiro</span><span class="pay-desc">Pagar na entrega</span></div>
          <div class="pay-check"></div>
        </div>
        <div class="pay-option" onclick="selectPay(this, 'pix')">
          <div class="pay-icon-box">üí†</div>
          <div class="pay-info"><span class="pay-title">PIX</span><span class="pay-desc">Pagamento online</span></div>
          <div class="pay-check"></div>
        </div>
        <div class="pay-option" onclick="selectPay(this, 'cartao')">
          <div class="pay-icon-box">üí≥</div>
          <div class="pay-info"><span class="pay-title">Cart√£o</span><span class="pay-desc">Levar maquininha</span></div>
          <div class="pay-check"></div>
        </div>
      </div>

      <div id="cashChange" style="display:none; margin-top:10px;">
        <label style="font-size:12px; color:var(--accent); font-weight:bold;">Troco para quanto?</label>
        <input id="cashGiven" type="number" class="clean-input" placeholder="R$ 0,00" style="margin-top:5px;">
      </div>

      <div style="margin-top:25px; border-top:1px dashed rgba(255,255,255,0.1); padding-top:15px;">
        <div class="row"><span style="color:var(--muted)">Subtotal</span> <span id="subtotalText">R$0,00</span></div>
        <div class="row"><span style="color:var(--muted)">Entrega</span> <span id="feeText">R$4,99</span></div>
        <div class="row" style="margin-top:10px;"><span style="font-size:18px; font-weight:700;">Total</span> <span id="totalText" style="font-size:20px; font-weight:800; color:var(--accent);">R$0,00</span></div>
      </div>

      <div style="margin-top:30px;">
        <button id="confirmBtn" class="btn primary">Finalizar Pedido</button>
      </div>
    </div>
  </div>

  <div id="modal" class="modal-back">
    <div class="modal-card scale-in">
      <img id="modalImg" src="logo.jpeg" class="modal-hero-img">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2 id="modalTitle" style="margin:0; font-size:20px;">T√≠tulo</h2>
        <button id="closeModal" style="background:none; border:none; color:#fff; font-size:24px;">√ó</button>
      </div>
      <p id="modalDesc" style="color:var(--muted); font-size:14px; margin:5px 0 15px 0;"></p>
      <div style="font-size:24px; font-weight:800; color:var(--accent);">R$<span id="modalPrice">0,00</span></div>
      <div id="addonsSection" style="margin-top:20px; display:none;">
        <div style="font-size:12px; font-weight:700; color:#fff; margin-bottom:8px;">ADICIONAIS</div>
        <div id="addonsList"></div>
      </div>
      <div style="margin-top:20px;">
        <label style="font-size:12px; color:var(--muted);">Observa√ß√£o</label>
        <textarea id="note" class="clean-input" placeholder="Ex: Sem cebola"></textarea>
      </div>
      <div style="display:flex; align-items:center; gap:15px; margin-top:10px;">
        <div class="qty-row" style="margin:0;">
          <button id="decQty" class="qty-btn">-</button>
          <input id="qtyInput" class="qty-input" type="number" value="1" readonly>
          <button id="incQty" class="qty-btn">+</button>
        </div>
        <button id="addCart" class="btn primary" style="flex:1;">Adicionar</button>
      </div>
    </div>
  </div>

  <div id="pixModal" class="modal-back" style="z-index: 400;">
    <div class="modal-card" style="text-align:center; padding-top:40px; border-radius:24px;">
      <div id="pixContent" style="display:none;">
        <div style="font-size:40px; margin-bottom:10px;">üí†</div>
        <h3 style="margin:0;">Pagamento PIX</h3>
        <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:12px; margin:20px 0; word-break:break-all;">
          <input id="pixCodeInput" style="width:100%; background:transparent; border:none; color:#aaa; font-size:12px; text-align:center;" readonly>
        </div>
        <button id="btnCopy" class="btn ghost small" style="margin-bottom:15px; width:100%;">Copiar C√≥digo</button>
        <p style="font-size:13px; color:#f5a623;">Ap√≥s pagar, envie o comprovante.</p>
        <button id="btnSendProof" class="btn whatsapp">Enviar Comprovante</button>
        <button id="btnBackFromPix" class="btn ghost" style="margin-top:10px;">Voltar ao Card√°pio</button>
      </div>
      <div id="successContent" style="display:none;">
        <div style="width:80px; height:80px; background:var(--success); border-radius:50%; margin:0 auto 20px auto; display:flex; align-items:center; justify-content:center; font-size:40px; color:#fff;">‚úî</div>
        <h2 style="margin:0;">Pedido Confirmado!</h2>
        <p style="color:var(--muted); font-size:14px; margin-top:10px;">Clique abaixo para consultar o tempo de preparo.</p>
        <div style="margin-top:25px;">
          <button id="btnWaSuccess" class="btn whatsapp">Consultar Tempo de Preparo Ôì≤</button>
        </div>
        <button id="btnClosePix" class="btn ghost" style="margin-top:15px;">Fechar</button>
      </div>
    </div>
  </div>

  <script>
    /* DADOS */
    const CONFIG = {
      phone: '5534984405375',
      fee: 4.99,
      // CONFIGURA√á√ÉO OFUSCADA PARA SEGURAN√áA
      telegramToken: atob('ODUxNTIwODQwOTpBQUdSQU1ESFlORmdHdTFlWE9vWS10MU4wbHJDOXFtMGFpUQ=='),
      telegramChatId: atob('NjcwMDY3MDMzOA=='),
      pixKey: '14421d15-c771-4ab9-8e7f-fd69e987af1a',
      pixName: 'AVALANCHES JANUARIA', 
      pixCity: 'RIO DE JANEIRO'
    };

    /* BANCO DE DADOS */
    const DB = [
      {"id":"i_cq","cat":"hamburgueres","name":"Cachorro Quente na Chapa","desc":"P√£o, salsicha, mortadela, mussarela, batata, milho, molho especial","price":7.0, "image":"cachoro quente na chapa.jpeg"},
      {"id":"i_hb","cat":"hamburgueres","name":"Hamb√∫rguer","desc":"P√£o, carne, batata, alface, tomate, molho especial","price":12.0, "image":"logo.jpeg"},
      {"id":"i_fb","cat":"hamburgueres","name":"Franburguer","desc":"P√£o, frango desfiado, batata, alface, tomate, molho especial","price":13.0, "image":"logo.jpeg"},
      {"id":"i_am","cat":"hamburgueres","name":"Americano","desc":"P√£o, ovo, mussarela, presunto, batata, milho, alface, tomate, molho especial","price":14.0, "image":"logo.jpeg"},
      {"id":"i_xf","cat":"hamburgueres","name":"X-Frango","desc":"P√£o, frango desfiado, milho, presunto, batata, alface, tomate, molho especial","price":15.0, "image":"logo.jpeg"},
      {"id":"i_xb","cat":"hamburgueres","name":"X-Burguer","desc":"P√£o, carne, mussarela, batata, milho, alface, tomate, molho especial","price":15.0, "image":"xburguer.jpeg"},
      {"id":"i_fbcn","cat":"hamburgueres","name":"Franbacon","desc":"P√£o, frango desfiado, bacon, batata, alface, tomate, molho especial","price":17.0, "image":"logo.jpeg"},
      {"id":"i_calafr","cat":"hamburgueres","name":"Calafrango","desc":"P√£o, frango desfiado, calabresa, mussarela, milho, batata, alface, tomate, molho especial","price":17.0, "image":"calafrango.jpeg"},
      {"id":"i_xbegg","cat":"hamburgueres","name":"X-Burguer Egg","desc":"P√£o, carne, ovo, mussarela, batata, milho, alface, tomate, molho especial","price":17.0, "image":"logo.jpeg"},
      {"id":"i_xcal","cat":"hamburgueres","name":"X-Calabresa","desc":"P√£o, carne, calabresa, mussarela, batata, milho, alface, tomate, molho especial","price":17.0, "image":"logo.jpeg"},
      {"id":"i_fbegg","cat":"hamburgueres","name":"Franbacon-Egg","desc":"P√£o, frango desfiado, ovo, bacon, batata, alface, tomate, molho especial","price":18.0, "image":"logo.jpeg"},
      {"id":"i_xbac","cat":"hamburgueres","name":"X-Bacon","desc":"P√£o, carne, bacon, mussarela, milho, batata, alface, tomate, molho especial","price":18.0, "image":"xbacon.jpeg"},
      {"id":"i_xbacegg","cat":"hamburgueres","name":"X-Bacon Egg","desc":"P√£o, carne, bacon, ovo, mussarela, milho, batata, alface, tomate, molho especial","price":20.0, "image":"logo.jpeg"},
      {"id":"i_xtudo","cat":"hamburgueres","name":"X-Tudo","desc":"P√£o, carne, bacon, ovo, presunto, mussarela, calabresa, milho, batata, alface, tomate, molho especial","price":25.0, "image":"xtudo.jpeg"},
      {"id":"i_av","cat":"hamburgueres","name":"Avalanches","desc":"P√£o, carne, bacon, frango, ovo, presunto, mussarela, calabresa, cebola roxa, milho, batata, alface, tomate, molho especial","price":27.0, "image":"Avalanche.jpeg"},
      {"id":"b_coca2","cat":"bebidas","name":"Coca-Cola 2L","desc":"Garrafa 2 litros","price":15.0, "image":"coca-cola 2l.jpg"},
      {"id":"b_coca350","cat":"bebidas","name":"Coca-Cola Lata","desc":"350ml","price":5.5, "image":"coca-cola lata.jpg"},
      {"id":"b_fanta2","cat":"bebidas","name":"Guaran√° Lata","desc":"350ml","price":5.0, "image":"gurana lata.jpg"},
      {"id":"b_guarana1","cat":"bebidas","name":"Guaran√° 1L","desc":"Garrafa 1 litro","price":8.0, "image":"guarana 1l.jpg"},
      {"id":"a_carne","cat":"adicionais","name":"Carne","price":4.0},
      {"id":"a_frango","cat":"adicionais","name":"Frango","price":4.0},
      {"id":"a_bacon","cat":"adicionais","name":"Bacon","price":4.0},
      {"id":"a_calabresa","cat":"adicionais","name":"Calabresa","price":4.0},
      {"id":"a_presunto","cat":"adicionais","name":"Presunto","price":2.0},
      {"id":"a_mussarela","cat":"adicionais","name":"Mussarela","price":3.0},
      {"id":"a_ovo","cat":"adicionais","name":"Ovo","price":3.0},
      {"id":"a_milho","cat":"adicionais","name":"Milho","price":2.0},
      {"id":"a_batata","cat":"adicionais","name":"Batata","price":2.0}
    ];

    const ITEMS = DB.filter(i => i.cat !== 'adicionais');
    const ADDONS = DB.filter(i => i.cat === 'adicionais');
    let CART = {};
    let PAYMENT = '';
    let WA_MSG = '';
    let map, marker, userLat = 0, userLng = 0;

    const el = id => document.getElementById(id);
    const fmt = v => 'R$' + Number(v).toFixed(2).replace('.',',');

    // TOAST
    function showToast(msg, isError = true) {
      const container = el('toast-container');
      const toast = document.createElement('div');
      toast.className = `toast ${isError ? 'error' : 'success'}`;
      toast.innerHTML = isError ? `<span>‚ö†Ô∏è</span> ${msg}` : `<span>‚úì</span> ${msg}`;
      container.appendChild(toast);
      setTimeout(() => {
        toast.style.animation = 'fadeOut 0.4s forwards';
        toast.addEventListener('animationend', () => toast.remove());
      }, 3000);
    }

    // CHECK STORE - BLOQUEIO DE INTERA√á√ÉO
    function checkOpenStatus() {
        const now = new Date();
        const day = now.getDay(); 
        const hour = now.getHours();
        const min = now.getMinutes();
        const totalMins = hour * 60 + min;
        let isOpen = false;
        let effectiveDay = day;
        let effectiveMins = totalMins;
        if (totalMins < 180) { // Madrugada
             effectiveDay = day - 1;
             if (effectiveDay < 0) effectiveDay = 6;
             effectiveMins = totalMins + 1440;
        }
        if (effectiveDay >= 0 && effectiveDay <= 4) {
            if (effectiveMins >= 1140 && effectiveMins <= 1439) isOpen = true; // 19:00 - 23:59
        } else if (effectiveDay === 5 || effectiveDay === 6) {
            if (effectiveMins >= 1140 && effectiveMins <= 1590) isOpen = true; // 19:00 - 02:30
        }
        const badge = document.getElementById('storeStatus');
        
        // APLICA O BLOQUEIO NA P√ÅGINA
        if(isOpen) {
            badge.innerHTML = '<span class="status-dot"></span> Aberto Agora';
            badge.className = 'status-badge';
            document.body.classList.remove('closed');
        } else {
            badge.innerHTML = '<span class="status-dot red"></span> Loja Fechada';
            badge.className = 'status-badge closed';
            document.body.classList.add('closed');
        }
    }
    setInterval(checkOpenStatus, 60000);
    checkOpenStatus();

    // INPUT VISUAL VALIDATION
    ['clientName', 'clientAddress', 'houseNumber'].forEach(id => {
       el(id).addEventListener('input', function() {
          if(this.value.trim() !== "") {
             this.classList.remove('input-error');
             this.classList.add('input-valid');
          } else {
             this.classList.remove('input-valid');
          }
       });
    });

    function render(cat='all', q='') {
      const list = el('menuList'); list.innerHTML='';
      const filtered = ITEMS.filter(i => (cat==='all' || i.cat===cat) && (i.name.toLowerCase().includes(q) || i.desc.toLowerCase().includes(q)));
      filtered.forEach((it, idx) => {
        const div = document.createElement('div'); div.className='card';
        div.style.animationDelay = (idx*0.05)+'s';
        const imgUrl = it.image ? it.image : 'logo.jpeg';
        div.innerHTML = `
          <div class="thumb"><img src="${imgUrl}" alt="${it.name}"></div>
          <div class="info">
            <div class="title">${it.name}</div>
            <div class="desc">${it.desc}</div>
            <div class="row">
              <div class="price">${fmt(it.price)}</div>
              <button class="btn primary" style="width:auto; padding:6px 15px; font-size:12px; height:32px;" onclick="openItem('${it.id}')">Adicionar</button>
            </div>
          </div>
        `;
        list.appendChild(div);
      });
    }

    window.openItem = (id) => {
      const it = ITEMS.find(x=>x.id===id); if(!it) return;
      el('modal').style.display='flex';
      el('modalImg').src = it.image ? it.image : 'logo.jpeg'; 
      el('modalTitle').innerText = it.name;
      el('modalDesc').innerText = it.desc;
      el('modalPrice').innerText = Number(it.price).toFixed(2).replace('.',',');
      el('qtyInput').value=1; el('note').value=''; el('addCart').dataset.id=id;
      const addsDiv = el('addonsSection'); const addsList = el('addonsList'); addsList.innerHTML='';
      if(it.cat==='hamburgueres') {
        addsDiv.style.display='block';
        ADDONS.forEach(a => {
          const l = document.createElement('div'); l.className='addon-label';
          l.innerHTML = `<span>${a.name}</span> <div style="display:flex;align-items:center;gap:10px;"><span style="color:var(--accent);font-weight:700;">+${fmt(a.price)}</span> <input type="checkbox" value="${a.id}" data-price="${a.price}"></div>`;
          addsList.appendChild(l);
          l.querySelector('input').onchange = (e) => {
            if(e.target.checked) l.classList.add('active'); else l.classList.remove('active');
            updateModalPrice(it.price);
          };
        });
      } else { addsDiv.style.display='none'; }
    };

    function updateModalPrice(base) {
      let total = base;
      el('addonsList').querySelectorAll('input:checked').forEach(c => total += parseFloat(c.dataset.price));
      el('modalPrice').innerText = Number(total).toFixed(2).replace('.',',');
    }

    el('addCart').onclick = () => {
      const id = el('addCart').dataset.id;
      const base = ITEMS.find(x=>x.id===id);
      const qty = parseInt(el('qtyInput').value);
      let adds = [], cost = 0;
      el('addonsList').querySelectorAll('input:checked').forEach(c => {
        const a = ADDONS.find(x=>x.id===c.value);
        adds.push(a); cost+=a.price;
      });
      CART[Date.now()] = { item: base, qty, adds, unitPrice: base.price+cost, note: el('note').value };
      el('modal').style.display='none';
      showToast('Adicionado √† sacola!', false);
      updateCart();
    };

    function updateCart() {
      const keys = Object.keys(CART);
      let total = 0;
      const cList = el('cartItems'); cList.innerHTML='';
      if(keys.length > 0) {
        el('cartbar').style.display='flex';
        keys.forEach(k => {
          const r = CART[k];
          const rTotal = r.qty * r.unitPrice;
          total += rTotal;
          const itemImg = r.item.image ? r.item.image : 'logo.jpeg';
          const div = document.createElement('div'); div.className='cart-item';
          div.innerHTML = `
            <img src="${itemImg}" class="cart-thumb-small">
            <div class="cart-item-details">
              <div class="cart-item-name">${r.item.name}</div>
              ${r.adds.length ? `<div class="cart-addons">+ ${r.adds.map(x=>x.name).join(', ')}</div>` : ''}
              ${r.note ? `<div class="cart-obs">Obs: ${r.note}</div>` : ''}
              <div class="cart-actions-row">
                <span class="remove-link" onclick="removeCart('${k}')">Remover</span>
                <div class="cart-price-right">
                  <div class="cart-qty-price">${r.qty}x ${fmt(r.unitPrice)}</div>
                  <div class="cart-total-price">${fmt(rTotal)}</div>
                </div>
              </div>
            </div>
          `;
          cList.appendChild(div);
        });
      } else {
        el('cartbar').style.display='none';
        cList.innerHTML='<div style="text-align:center;color:#666;padding:40px;">Sua sacola est√° vazia</div>';
        closeCartPage(); 
      }
      el('cartSubtotal').innerText = fmt(total + CONFIG.fee); 
      el('subtotalText').innerText = fmt(total);
      el('totalText').innerText = fmt(total + CONFIG.fee);
    }

    window.removeCart = (k) => { delete CART[k]; updateCart(); };

    const openCartPage = () => { el('cartPage').classList.add('active'); el('cartbar').classList.add('hidden'); if(!map) setTimeout(initMap, 300); };
    const closeCartPage = () => { el('cartPage').classList.remove('active'); el('cartbar').classList.remove('hidden'); };
    el('openCartBtn').onclick = openCartPage;
    el('closeCartBtn').onclick = closeCartPage;

    function initMap() {
      const defaultLat = -15.4839; const defaultLng = -44.3664;
      map = L.map('map').setView([defaultLat, defaultLng], 15);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '¬© OpenStreetMap' }).addTo(map);
      marker = L.marker([defaultLat, defaultLng], {draggable: true}).addTo(map);
      marker.on('dragend', function(e) {
        const pos = marker.getLatLng();
        userLat = pos.lat; userLng = pos.lng;
        fetchAddress(userLat, userLng);
      });
      userLat = defaultLat; userLng = defaultLng;
    }

    function fetchAddress(lat, lng) {
      fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`)
        .then(res => res.json())
        .then(data => {
           if(data.address) {
             const a = data.address;
             let street = a.road || a.street || '';
             let number = a.house_number || '';
             let suburb = a.suburb || a.neighbourhood || '';
             let cleanAddr = street;
             
             if(number && !el('houseNumber').value) {
                el('houseNumber').value = number;
                el('houseNumber').classList.add('input-valid');
             }
             if(suburb) cleanAddr += ` - ${suburb}`;
             if(!cleanAddr) cleanAddr = data.display_name.split(',')[0];

             el('clientAddress').value = cleanAddr;
             el('clientAddress').classList.add('input-valid');
           }
        })
        .catch(err => console.log(err));
    }

    el('btnLocate').onclick = () => {
      if (navigator.geolocation) {
        el('btnLocate').innerText = 'Buscando...';
        navigator.geolocation.getCurrentPosition(
          (pos) => {
            const lat = pos.coords.latitude; const lng = pos.coords.longitude;
            userLat = lat; userLng = lng;
            map.setView([lat, lng], 17);
            marker.setLatLng([lat, lng]);
            el('btnLocate').innerText = 'üìç Localiza√ß√£o Definida!';
            fetchAddress(lat, lng);
          },
          () => { showToast('Erro ao obter GPS. Use HTTPS ou arraste o pino.'); el('btnLocate').innerText = 'üìç Usar minha localiza√ß√£o atual'; },
          { enableHighAccuracy: true, timeout: 10000 }
        );
      } else { showToast('Sem suporte a GPS.'); }
    };

    window.selectPay = (div, type) => {
      document.querySelectorAll('.pay-option').forEach(d => d.classList.remove('selected'));
      div.classList.add('selected'); PAYMENT = type;
      el('cashChange').style.display = (type==='dinheiro') ? 'block' : 'none';
    };

    async function sendToTelegram(message) {
      try {
        await fetch(`https://api.telegram.org/bot${CONFIG.telegramToken}/sendMessage`, {
          method: 'POST', headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ chat_id: CONFIG.telegramChatId, text: message, parse_mode: 'Markdown' })
        });
      } catch (err) {}
    }

    el('confirmBtn').onclick = async () => {
      const name = el('clientName').value;
      const addrStreet = el('clientAddress').value;
      const addrNum = el('houseNumber').value;
      
      if(Object.keys(CART).length === 0) return showToast('Sacola vazia!');
      if(!name) { el('clientName').classList.add('input-error'); return showToast('Informe seu nome'); }
      if(!addrStreet) { el('clientAddress').classList.add('input-error'); return showToast('Informe a rua'); }
      if(!addrNum) { el('houseNumber').classList.add('input-error'); return showToast('Informe o n√∫mero'); }
      if(!PAYMENT) return showToast('Selecione o pagamento');

      const fullAddr = `${addrStreet}, N¬∫ ${addrNum}`;
      const orderId = '#' + Math.floor(1000 + Math.random() * 9000);
      let mapsLink = '';
      if(userLat !== 0 && userLng !== 0) mapsLink = `https://www.google.com/maps/search/?api=1&query=${userLat},${userLng}`;

      let msg = `üÜî *PEDIDO ${orderId} (SITE)*\nüë§ *Cliente:* ${name}\nüìç *Endere√ßo:* ${fullAddr}\n`;
      if(mapsLink) msg += `üó∫Ô∏è *GPS:* [Abrir no Maps](${mapsLink})\n`;
      msg += `üí∞ *Pagamento:* ${PAYMENT.toUpperCase()}\n`;
      if(PAYMENT==='dinheiro' && el('cashGiven').value) msg += `Troco para: R$${el('cashGiven').value}\n`;
      msg += `----------------\n`;
      let total = 0;
      Object.values(CART).forEach(r => {
        msg += `${r.qty}x ${r.item.name}`;
        if(r.adds.length) msg += ` (+ ${r.adds.map(a=>a.name).join(',')})`;
        msg += `\n`;
        if(r.note) msg += `_Obs: ${r.note}_\n`;
        total += (r.qty * r.unitPrice);
      });
      const grandTotal = total + CONFIG.fee;
      msg += `----------------\nSubtotal: ${fmt(total)}\nTaxa: ${fmt(CONFIG.fee)}\n*TOTAL: ${fmt(grandTotal)}*`;

      WA_MSG = `Este √© o meu c√≥digo de pedido: ${orderId}. Qual o tempo de preparo?`;
      sendToTelegram(msg);

      el('pixModal').style.display='flex';
      if(PAYMENT === 'pix') {
        el('pixContent').style.display='block'; el('successContent').style.display='none';
        
        // CALCULA E GERA O PIX
        const code = generatePix(grandTotal);
        el('pixCodeInput').value = code;
        
        el('btnSendProof').onclick = () => {
          const pixMsg = `Este √© o meu c√≥digo de pedido: ${orderId}. Segue comprovante do PIX. Qual o tempo de preparo?`;
          window.open(`https://wa.me/${CONFIG.phone}?text=${encodeURIComponent(pixMsg)}`);
        };
      } else {
        el('pixContent').style.display='none'; el('successContent').style.display='block';
        el('btnWaSuccess').onclick = () => { window.open(`https://wa.me/${CONFIG.phone}?text=${encodeURIComponent(WA_MSG)}`); };
      }
      closeCartPage();
    };

    function generatePix(val) {
      const amount = val.toFixed(2);
      
      const emv = (id, val) => {
         const len = val.length.toString().padStart(2, '0');
         return id + len + val;
      };
      
      const merchantAccount = emv('00', 'BR.GOV.BCB.PIX') + emv('01', CONFIG.pixKey);
      
      let payload = 
        emv('00', '01') +
        emv('26', merchantAccount) +
        emv('52', '0000') +
        emv('53', '986') +
        emv('54', amount) +
        emv('58', 'BR') +
        emv('59', CONFIG.pixName) +
        emv('60', CONFIG.pixCity) +
        emv('62', emv('05', 'AVALANCHES')) + 
        '6304';
      
      return payload + crc16(payload);
    }

    function crc16(s) {
      let c = 0xFFFF;
      for(let i=0;i<s.length;i++){ c ^= s.charCodeAt(i) << 8; for(let j=0;j<8;j++) c = (c & 0x8000) ? (c << 1) ^ 0x1021 : c << 1; }
      return (c & 0xFFFF).toString(16).toUpperCase().padStart(4,'0');
    }
    
    el('btnCopy').onclick = () => { 
      const inp = el('pixCodeInput'); inp.select(); inp.setSelectionRange(0,99999);
      navigator.clipboard.writeText(inp.value).then(() => {
        const originalText = el('btnCopy').innerText;
        el('btnCopy').innerText = 'Chave Copiada! ‚úì'; el('btnCopy').style.background = '#34c759'; el('btnCopy').style.color = '#fff';
        showToast('Chave PIX copiada!', false);
        setTimeout(() => { el('btnCopy').innerText = 'Copiar C√≥digo'; el('btnCopy').style.background = ''; el('btnCopy').style.color = ''; }, 2000);
      });
    };
    
    el('btnClosePix').onclick = () => el('pixModal').style.display='none';
    el('closeModal').onclick = () => el('modal').style.display='none';
    el('btnBackFromPix').onclick = () => el('pixModal').style.display='none';

    el('decQty').onclick = () => { if(el('qtyInput').value>1) el('qtyInput').value--; };
    el('incQty').onclick = () => el('qtyInput').value++;

    document.querySelectorAll('.tab').forEach(t => t.onclick = () => {
      document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active')); t.classList.add('active');
      render(t.dataset.cat, el('search').value.toLowerCase());
    });
    el('search').oninput = () => render(document.querySelector('.tab.active').dataset.cat, el('search').value.toLowerCase());

    render();
  </script>
</body>
</html>
